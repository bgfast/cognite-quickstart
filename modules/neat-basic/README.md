# Neat Basic Data Model

This module contains a basic data model generated using the neat library, along with comprehensive testing tools for validation and development.

## Purpose

The Neat Basic Data Model module provides:
- **Basic data model structure** generated with neat
- **Simple containers and views** for common data types
- **Foundation for data modeling** using neat best practices
- **Comprehensive testing suite** for validation and development

## Structure

### Data Models
- `neat-basic.space.yaml` - Main space for the data model
- `containers/` - Container definitions (generated by neat)
  - `BasicAsset.container.yaml` - Basic asset container with name, description, and type
- `views/` - View definitions (generated by neat)
  - `BasicAsset.view.yaml` - Basic asset view for data access

### Data Sets
- `neat-basic-dataset.DataSet.yaml` - Dataset for data governance

### Testing Tools
- `test_neat_data_model.py` - Comprehensive data model testing script
- `sample_data_generator.py` - Sample data generator for testing
- `neat_integration_test.py` - End-to-end integration testing with Cognite Toolkit

### NEAT Generation Tools
- `generate_edm_yaml_files.py` - Generate YAML files from NeatBasic.xlsx using NEAT
- `NeatBasic.xlsx` - Excel file containing the NEAT data model definition

### Configuration
- `config.neat-basic.yaml` - Configuration file for deploying the NEAT Basic module

## Usage

### Generating YAML Files from Excel

If you need to regenerate the YAML files from the `NeatBasic.xlsx` file:

```bash
cd modules/neat-basic

# Ensure environment is set up
source ../../cdfenv.sh
cdfenv bgfast  # or your environment name

# Generate YAML files from Excel
python generate_edm_yaml_files.py
```

This will:
- ğŸ“Š Process the `NeatBasic.xlsx` file using NEAT
- ğŸ” Inspect for any data model issues
- ğŸ“ Generate CDF Toolkit-compatible YAML files
- ğŸ“‹ List all generated files
- ğŸ§ª Optionally run integration tests

### Basic Deployment

This module should be deployed after the foundation module to provide basic data modeling capabilities.

```bash
# Build and deploy using Cognite Toolkit with neat-basic config
cdf-tk build --env neat-basic
cdf-tk deploy --env neat-basic --dry-run  # Test first
cdf-tk deploy --env neat-basic            # Deploy for real

# Or use the weather config if you prefer
cdf-tk build --env weather
cdf-tk deploy --env weather --dry-run
cdf-tk deploy --env weather
```

### Testing Your NEAT Data Model

#### 1. Comprehensive Data Model Testing

Test your deployed data model with full validation:

```bash
cd modules/neat-basic
python test_neat_data_model.py
```

This will test:
- âœ… Space deployment and configuration
- âœ… Container deployment with correct properties
- âœ… View deployment and accessibility
- âœ… Instance creation and validation
- âœ… Data querying capabilities
- âœ… Data validation constraints

#### 2. Sample Data Generation

Generate realistic test data for your BasicAsset model:

```bash
cd modules/neat-basic
python sample_data_generator.py
```

Features:
- ğŸ­ Generate realistic asset instances (pumps, compressors, generators, etc.)
- ğŸ” Dry-run mode to preview data before creation
- ğŸ“‹ List existing assets in your data model
- ğŸ§¹ Cleanup utilities for test data

#### 3. End-to-End Integration Testing

Run complete workflow testing from build to data operations:

```bash
cd modules/neat-basic
python neat_integration_test.py
```

This provides:
- ğŸ” Prerequisites validation
- ğŸ—ï¸ Automated toolkit build
- ğŸš€ Deployment testing (dry-run and real)
- ğŸ§ª Data model validation
- ğŸ­ Sample data operations
- ğŸ“Š Comprehensive reporting

### Interactive Testing Menus

All testing scripts provide interactive menus for easy testing:

```
Select test to run:
1. Prerequisites check only
2. Build and dry-run deploy only
3. Full integration test (no real deploy)
4. Full integration test (with real deploy)
5. NEAT tests only
6. Sample data operations only
7. Exit
```

## BasicAsset Data Model

The BasicAsset model includes:

### Properties
- **name** (required): Asset name
- **description** (optional): Asset description  
- **type** (optional): Asset type/category

### Example Usage

```python
from cognite.client import CogniteClient
from cognite.client.data_classes import NodeApply

# Create a BasicAsset instance
asset = NodeApply(
    space="neat-basic",
    external_id="my_pump_001",
    sources=[{
        "source": {
            "space": "neat-basic",
            "externalId": "BasicAsset",
            "version": "1"
        },
        "properties": {
            "name": "Main Water Pump",
            "description": "Primary water circulation pump",
            "type": "pump"
        }
    }]
)

# Apply to CDF
client = CogniteClient.default_oauth_interactive(project="your-project")
result = client.data_modeling.instances.apply(nodes=[asset])
```

## Dependencies

- CDF project with data modeling capabilities enabled
- Foundation module (for basic setup)
- Python packages: `cognite-sdk`, `cognite-toolkit`, `cognite-neat` (for YAML generation)
- Configuration: `config.neat-basic.yaml` (provided in project root)

## Environment Setup

Ensure your environment is configured:

```bash
# Set up CDF environment
source cdfenv.sh
cdfenv bgfast  # or your environment name

# Verify setup
echo $CDF_PROJECT
echo $CDF_CLUSTER
```

## Configuration File

The `config.neat-basic.yaml` file provides:

- **Module Selection**: Automatically includes foundation and neat-basic modules
- **NEAT-specific Variables**: Space names, container IDs, dataset names
- **Testing Configuration**: Test asset prefixes, sample counts, cleanup settings
- **Environment Variables**: CDF project, cluster, and authentication settings

### Using the Config File

```bash
# Deploy using the neat-basic configuration
cdf-tk build --env neat-basic
cdf-tk deploy --env neat-basic --dry-run
cdf-tk deploy --env neat-basic

# The config automatically includes:
# - modules/common/foundation (basic setup)
# - modules/neat-basic (your NEAT data model)
```

## Neat Integration

The data model files in this module are generated using the neat library:
- **Excel Source**: `NeatBasic.xlsx` contains the data model definition
- **YAML Generation**: `generate_edm_yaml_files.py` processes Excel into toolkit YAML
- **Containers**: Define the data structure and validation rules
- **Views**: Provide the interface for data access and querying
- **Best Practices**: Generated following NEAT and CDF Toolkit conventions

## Testing Best Practices

1. **Always test with dry-run first** - Use dry-run modes to validate before making changes
2. **Use sample data for development** - Generate realistic test data for development and testing
3. **Run integration tests** - Validate the complete workflow from deployment to data operations
4. **Clean up test data** - Use cleanup utilities to maintain a clean testing environment
5. **Monitor test results** - Review generated test reports for detailed analysis

## Troubleshooting

### Common Issues

1. **CDF_PROJECT not set**: Run `source cdfenv.sh && cdfenv <your-env>`
2. **Permission errors**: Ensure your CDF user has data modeling permissions
3. **Module not found**: Ensure you're in the correct directory and dependencies are installed
4. **Deployment failures**: Check prerequisites and run dry-run deploy first

### Getting Help

- Check test reports generated in JSON format for detailed error information
- Use verbose mode in testing scripts for detailed logging
- Review CDF logs for deployment-related issues
